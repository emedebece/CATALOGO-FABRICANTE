<html lang="es"><head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>CatÃ¡logo Oficial - Fabricante</title>
Â  Â  <style>
Â  Â  Â  Â  /* --- ESTILOS GENERALES Y LAYOUT --- */
Â  Â  Â  Â  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; background-color: #f8f8f8; padding-bottom: 120px; color: #333; }
Â  Â  Â  Â  header { background-color: #D60000; color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
Â  Â  Â  Â  h1 { margin: 0; font-size: 1.4rem; text-transform: uppercase; letter-spacing: 1px; }Â 
Â  Â  Â  Â  .subtitle { font-size: 0.8rem; color: rgba(255,255,255,0.8); margin-top: 4px; }
Â  Â  Â  Â  .quality-description { padding: 20px 15px; background-color: white; border-bottom: 1px solid #eee; text-align: center; font-size: 0.9rem; color: #555; line-height: 1.5; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* BARRA DE TALLES */
Â  Â  Â  Â  .size-bar { display: flex; gap: 10px; padding: 15px; background: white; overflow-x: auto; white-space: nowrap; border-bottom: 1px solid #e0e0e0; scrollbar-width: none; }
Â  Â  Â  Â  .size-bar::-webkit-scrollbar { display: none; }
Â  Â  Â  Â  .size-btn { flex: 0 0 auto; padding: 10px 20px; border: 1px solid #333; background: white; color: #333; border-radius: 50px; font-weight: bold; font-size: 0.9rem; transition: 0.2s; cursor: pointer; }
Â  Â  Â  Â  .size-btn.active { background: #D60000; color: white; border-color: #D60000; transform: scale(1.05); }

Â  Â  Â  Â  /* GRILLA DE PRODUCTOS: 2 COLUMNAS */
Â  Â  Â  Â  .grid {Â 
Â  Â  Â  Â  Â  Â  display: grid;Â 
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(2, 1fr);Â 
Â  Â  Â  Â  Â  Â  gap: 10px;Â 
Â  Â  Â  Â  Â  Â  padding: 10px;Â 
Â  Â  Â  Â  Â  Â  max-width: 800px;Â 
Â  Â  Â  Â  Â  Â  margin: 0 auto;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* TARJETA DE PRODUCTO */
Â  Â  Â  Â  .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; flex-direction: column; position: relative; }
Â  Â  Â  Â  .card.agotado { opacity: 0.6; filter: grayscale(100%); order: 9999; }
Â  Â  Â  Â  .card.agotado::after { content: "SIN STOCK"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-10deg); border: 2px solid #D60000; color: #D60000; font-weight: bold; padding: 5px 10px; border-radius: 5px; background: rgba(255,255,255,0.9); z-index: 10; font-size: 1rem; }
Â  Â  Â  Â  .card-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; background: #eee; }
Â  Â  Â  Â  .card-body { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* TÃTULO COMPLETO */
Â  Â  Â  Â  .card-title {Â 
Â  Â  Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  Â  Â  font-size: 0.85rem;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 4px;Â 
Â  Â  Â  Â  Â  Â  line-height: 1.2;Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card-price { font-size: 1rem; font-weight: 800; color: #111; margin-top: auto; }
Â  Â  Â  Â  .stock-qty { font-size: 0.75rem; color: #777; margin-top: 2px; }
Â  Â  Â  Â  .stock-qty.low { color: #D60000; font-weight: bold; }
Â  Â  Â  Â  .btn-add { width: 100%; padding: 10px; background: #333; color: white; border: none; font-weight: 600; border-radius: 8px; margin-top: 8px; font-size: 0.85rem; cursor: pointer; }
Â  Â  Â  Â  .btn-add:disabled { background: #ccc; cursor: not-allowed; }

Â  Â  Â  Â  /* BARRA INFERIOR FLOTANTE */
Â  Â  Â  Â  .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #eee; padding: 15px; box-shadow: 0 -4px 20px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; z-index: 2000; box-sizing: border-box; padding-bottom: max(15px, env(safe-area-inset-bottom)); }
Â  Â  Â  Â  .nav-info { display: flex; flex-direction: column; }
Â  Â  Â  Â  .nav-total { font-weight: 800; font-size: 1.1rem; color: #333; }
Â  Â  Â  Â  .nav-count { font-size: 0.8rem; color: #D60000; font-weight: bold; }
Â  Â  Â  Â  .nav-count.ready-status { color: #25D366; }
Â  Â  Â  Â  .btn-whatsapp { background: #25D366; color: white; text-decoration: none; padding: 12px 20px; border-radius: 50px; font-weight: bold; font-size: 0.9rem; opacity: 0.5; pointer-events: none; transition: 0.3s; }
Â  Â  Â  Â  .btn-whatsapp.ready { opacity: 1; pointer-events: auto; }

Â  Â  Â  Â  /* PANEL DE ADMINISTRACIÃ“N OCULTO */
Â  Â  Â  Â  #adminPanel {Â 
Â  Â  Â  Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;Â 
Â  Â  Â  Â  Â  Â  background: rgba(0, 0, 0, 0.95); color: white; z-index: 5000;Â 
Â  Â  Â  Â  Â  Â  padding: 10px; box-sizing: border-box; display: none;Â 
Â  Â  Â  Â  Â  Â  flex-direction: column; align-items: center; overflow-y: auto;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  #adminPanel.show { display: flex; }
Â  Â  Â  Â  #adminPanel h2 { color: #FFD700; margin-top: 0; }
Â  Â  Â  Â  #adminPanel table { width: 100%; max-width: 800px; border-collapse: collapse; margin-top: 15px; background: white; color: #333; font-size: 0.8rem; }
Â  Â  Â  Â  #adminPanel th, #adminPanel td { border: 1px solid #ddd; padding: 8px; text-align: center; }
Â  Â  Â  Â  #adminPanel th { background-color: #f2f2f2; color: #333; position: sticky; top: 0; }
Â  Â  Â  Â  #adminPanel td:nth-child(1) { text-align: left; max-width: 150px; white-space: normal; overflow: visible; text-overflow: clip; }Â 
Â  Â  Â  Â  .stock-control { display: flex; align-items: center; justify-content: center; gap: 5px; }
Â  Â  Â  Â  .stock-control button { width: 25px; height: 25px; border: none; background: #D60000; color: white; border-radius: 4px; font-weight: bold; cursor: pointer; padding: 0; line-height: 1; }
Â  Â  Â  Â  .stock-control span { min-width: 20px; display: inline-block; text-align: center; font-weight: bold; }
Â  Â  Â  Â  .admin-buttons { position: sticky; bottom: 0; background: rgba(0, 0, 0, 0.95); padding: 15px; width: 100%; max-width: 800px; text-align: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.5); }
Â  Â  Â  Â  .admin-buttons button { background: #25D366; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin: 5px; }
Â  Â  Â  Â  .admin-buttons a { color: #D60000; font-weight: bold; margin: 5px; cursor: pointer; text-decoration: none; display: block; margin-top: 10px; }

Â  Â  Â  Â  /* ESTILOS AÃ‘ADIDOS PARA NUEVO PRODUCTO */
Â  Â  Â  Â  .new-product-form { background: #333; padding: 15px; border-radius: 8px; margin-top: 20px; width: 100%; max-width: 800px; box-sizing: border-box; }
Â  Â  Â  Â  .new-product-form h3 { color: #FFD700; border-bottom: 1px solid #555; padding-bottom: 10px; margin-top: 0; font-size: 1.1rem; }
Â  Â  Â  Â  .new-product-form input {Â 
Â  Â  Â  Â  Â  Â  width: 100%; padding: 8px; margin-bottom: 8px; border: none;Â 
Â  Â  Â  Â  Â  Â  border-radius: 4px; box-sizing: border-box; font-size: 0.9rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  .stock-input-group { display: flex; gap: 8px; margin-bottom: 10px; }
Â  Â  Â  Â  .stock-input-group > div { flex-grow: 1; }
Â  Â  Â  Â  .stock-input-group label { display: block; font-size: 0.7rem; color: #ccc; margin-bottom: 2px; }
Â  Â  Â  Â  .btn-add-product { background: #FF9800; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; width: 100%; }
Â  Â  </style>
</head>
<body>

<header>
Â  Â  <h1>CATALOGO - FABRICANTE</h1>
Â  Â  <div class="subtitle">CatÃ¡logo Mayorista - Stock Actualizado</div>
</header>

<div class="quality-description">
Â  Â  En <strong>CATÃLOGO - FABRICANTE</strong> nos enorgullece ofrecerte indumentaria de la mÃ¡s alta calidad.
</div>

<div class="size-bar">
Â  Â  <button class="size-btn" onclick="setTalle('S')">S</button>
Â  Â  <button class="size-btn" onclick="setTalle('M')">M</button>
Â  Â  <button class="size-btn" onclick="setTalle('L')">L</button>
Â  Â  <button class="size-btn" onclick="setTalle('XL')">XL</button>
Â  Â  <button class="size-btn" onclick="setTalle('XXL')">XXL</button>
</div>

<div style="text-align:center; padding: 15px 10px; font-weight:bold; color:#555; font-size: 0.9rem;" id="talleTitle">
Â  Â  ğŸ‘‡ Toca un talle para ver modelos
Â  Â  <input type="text" id="adminTrigger" onkeyup="checkAdminKey(this.value)" placeholder="Escribe 'admin' para abrir el panel" style="width:90%; max-width: 300px; padding: 8px; margin-top: 10px; border-radius: 4px; border: 1px solid #ccc; font-size: 0.9rem;">
</div>

<div class="grid" id="productGrid"></div>

<div id="toast" class="toast">âœ… Agregado</div>

<div class="bottom-nav">
Â  Â  <div class="nav-info">
Â  Â  Â  Â  <span class="nav-total" id="totalPrice">$0</span>
Â  Â  Â  Â  <span class="nav-count" id="totalCount">0 prendas (MÃ­n. 6)</span>
Â  Â  </div>
Â  Â  <a href="#" id="waButton" class="btn-whatsapp" target="_blank">CONFIRMAR PEDIDO</a>
</div>

<div id="adminPanel" class="show">
Â  Â Â 
Â  Â  <div class="new-product-form">
Â  Â  Â  Â  <h3>â• AÃ±adir Producto Nuevo</h3>
Â  Â  Â  Â  <input type="text" id="newProductName" placeholder="Nombre del Producto (Ej: Adidas Clasica Negro R:Francia)">
Â  Â  Â  Â  <input type="number" id="newProductPrice" placeholder="Precio (solo nÃºmeros, Ej: 10000)">
Â  Â  Â  Â  <input type="url" id="newProductImg" placeholder="URL de la Imagen (de Postimages o similar)">
Â  Â  Â  Â Â 
Â  Â  Â  Â  <label style="color:white; font-weight:bold; margin-top:10px; margin-bottom:5px; font-size:0.9rem;">Stock Inicial por Talle:</label>
Â  Â  Â  Â  <div class="stock-input-group">
Â  Â  Â  Â  Â  Â  <div><label>S</label><input type="number" id="newStockS" value="0" min="0"></div>
Â  Â  Â  Â  Â  Â  <div><label>M</label><input type="number" id="newStockM" value="0" min="0"></div>
Â  Â  Â  Â  Â  Â  <div><label>L</label><input type="number" id="newStockL" value="0" min="0"></div>
Â  Â  Â  Â  Â  Â  <div><label>XL</label><input type="number" id="newStockXL" value="0" min="0"></div>
Â  Â  Â  Â  Â  Â  <div><label>XXL</label><input type="number" id="newStockXXL" value="0" min="0"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <button class="btn-add-product" onclick="agregarNuevoProducto()">AGREGAR PRODUCTO A LA LISTA</button>
Â  Â  </div>
Â  Â  <h2 style="margin-top:20px;">ğŸ› ï¸ AJUSTE DE STOCK POR UNIDAD</h2>
Â  Â  <div class="admin-note" style="color: #ccc;">
Â  Â  Â  Â  Usa los botones [+] y [-] para modificar el stock de productos existentes.
Â  Â  </div>
Â  Â  <table id="adminTable">
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Modelo</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>S</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>M</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>L</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>XL</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>XXL</th>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody id="adminTableBody">
        </tbody>
Â  Â  </table>
Â  Â  <div class="admin-buttons">
Â  Â  Â  Â  <button onclick="saveStockToLocalStorage()">ğŸ’¾ Guardar Stock</button>
Â  Â  Â  Â  <button onclick="exportStock()">ğŸ“‹ Exportar Stock</button>
Â  Â  Â  Â  <a onclick="closeAdminPanel()">Cerrar Panel</a>
Â  Â  </div>
</div>

<script>
    // ğŸ”’ DATA AISLADA: Stock por defecto inicial.
    // **ESTE ES EL STOCK QUE HAS PROPORCIONADO EN TU TABLA HTML ORIGINAL.**
    const defaultStockData = [
        { name: "Adidas Clasica Negro R:Francia", price: 10000, img: "url-adidas-clasica.jpg", stock: { S: 1, M: 0, L: 0, XL: 0, XXL: 0 } },
        { name: "Alpinestar Clasico R:Negra", price: 10000, img: "url-alpinestar-clasico.jpg", stock: { S: 0, M: 0, L: 1, XL: 0, XXL: 0 } },
        { name: "Boss Cuadro Blanco R:Negra", price: 10000, img: "url-boss-cuadro-blanco.jpg", stock: { S: 0, M: 1, L: 0, XL: 0, XXL: 0 } },
        { name: "Boss Rayas Blancas R:Negra", price: 10000, img: "url-boss-rayas-blancas.jpg", stock: { S: 1, M: 1, L: 0, XL: 0, XXL: 0 } },
        { name: "Calvin Klein CK Gris/Blanco R:Negra", price: 10000, img: "url-ck-gris-blanco.jpg", stock: { S: 0, M: 1, L: 1, XL: 1, XXL: 1 } },
        { name: "Calvin Klein CK Gris/Negro R:Rosa", price: 10000, img: "url-ck-gris-negro.jpg", stock: { S: 0, M: 1, L: 1, XL: 0, XXL: 0 } },
        { name: "Ferrari Gris/Amarillo R:Negro", price: 10000, img: "url-ferrari-gris-amarillo.jpg", stock: { S: 0, M: 0, L: 0, XL: 0, XXL: 1 } },
        { name: "Fox Modelo Nuevo Blanco R:Negra", price: 10000, img: "url-fox-blanco.jpg", stock: { S: 1, M: 1, L: 2, XL: 1, XXL: 1 } },
        { name: "Fox Modelo Nuevo Negro R:Blanca", price: 10000, img: "url-fox-negro.jpg", stock: { S: 0, M: 0, L: 1, XL: 0, XXL: 0 } },
        { name: "Hugo Cuadro Rojo/blanco R:Negra", price: 10000, img: "url-hugo-cuadro.jpg", stock: { S: 1, M: 1, L: 0, XL: 1, XXL: 0 } },
        { name: "Jordan 23 R:Negro", price: 10000, img: "url-jordan-23.jpg", stock: { S: 0, M: 0, L: 0, XL: 1, XXL: 0 } },
        { name: "Jordan Bulls 23 Blanco R:Roja", price: 10000, img: "url-jordan-bulls-blanco.jpg", stock: { S: 0, M: 0, L: 0, XL: 2, XXL: 1 } },
        { name: "Jordan Bulls 23 Negro R:Roja", price: 10000, img: "url-jordan-bulls-negro.jpg", stock: { S: 0, M: 1, L: 1, XL: 0, XXL: 0 } },
        { name: "Jordan Fligh Blanco R:Negra", price: 10000, img: "url-jordan-flight.jpg", stock: { S: 0, M: 1, L: 0, XL: 0, XXL: 0 } }
    ];

    let products = []; // Array para almacenar los datos del stock (inicializados con defaultStockData)
    let currentTalle = 'S'; // Talle activo por defecto
    let cart = {}; // Carrito de compras: {productoIndex_talle: cantidad}
    const MIN_ITEMS = 6;
    const SIZES = ['S', 'M', 'L', 'XL', 'XXL'];

    // ğŸš© FUNCIÃ“N DE SEGURIDAD 1: Cargar datos de stock de forma segura desde Local Storage
    function loadStock() {
        const storedStock = localStorage.getItem('productStock');
        if (storedStock) {
            try {
                // Usamos JSON.parse de forma segura para evitar la ejecuciÃ³n de cÃ³digo arbitrario
                products = JSON.parse(storedStock);
                if (!Array.isArray(products) || products.length === 0) {
                    console.warn("Stock almacenado invÃ¡lido, usando stock por defecto.");
                    products = defaultStockData;
                }
            } catch (e) {
                console.error("Error al parsear el stock almacenado, usando stock por defecto.", e);
                products = defaultStockData;
            }
        } else {
            products = defaultStockData;
        }
        renderAdminTable(); // Renderizar la tabla de administraciÃ³n con el stock cargado
    }

    // ğŸš© FUNCIÃ“N DE SEGURIDAD 2: Guardar stock de forma segura en Local Storage
    function saveStockToLocalStorage() {
        // Usamos JSON.stringify para convertir el objeto de datos en una cadena
        localStorage.setItem('productStock', JSON.stringify(products));
        alert('Stock guardado exitosamente!');
        renderAdminTable();
        renderProducts(); // Actualizar la vista de usuario
    }

    // --- FUNCIONES DE ADMINISTRACIÃ“N ---

    // Renderiza la tabla en el panel de administraciÃ³n
    function renderAdminTable() {
        const adminTableBody = document.getElementById('adminTableBody');
        if (!adminTableBody) return;
        adminTableBody.innerHTML = '';

        products.forEach((product, index) => {
            let row = `<tr><td>${product.name}</td>`;
            SIZES.forEach(talle => {
                const currentStock = product.stock[talle] || 0;
                // Los botones llaman a la funciÃ³n 'ajustarStock' con los Ã­ndices y valores
                row += `<td>
                    <div class="stock-control">
                        <button onclick="ajustarStock(${index}, '${talle}', -1)">-</button>
                        <span id="stock-${index}-${talle}">${currentStock}</span>
                        <button onclick="ajustarStock(${index}, '${talle}', 1)">+</button>
                    </div>
                </td>`;
            });
            row += '</tr>';
            adminTableBody.innerHTML += row;
        });
    }

    // Ajusta el stock de un producto especÃ­fico
    function ajustarStock(index, talle, change) {
        if (products[index] && products[index].stock) {
            let currentStock = products[index].stock[talle] || 0;
            currentStock = Math.max(0, currentStock + change); // Asegura que no sea negativo
            products[index].stock[talle] = currentStock;

            // Actualiza la visualizaciÃ³n solo en el panel
            document.getElementById(`stock-${index}-${talle}`).textContent = currentStock;

            // Si se realiza un cambio, animar el botÃ³n de guardar como recordatorio
            const saveButton = document.querySelector('.admin-buttons button');
            if (saveButton) {
                saveButton.style.backgroundColor = '#FF0000';
                setTimeout(() => saveButton.style.backgroundColor = '#25D366', 300);
            }
        }
    }

    // Agrega un producto nuevo a la lista (desde el panel de admin)
    function agregarNuevoProducto() {
        const name = document.getElementById('newProductName').value.trim();
        const price = parseInt(document.getElementById('newProductPrice').value, 10);
        const img = document.getElementById('newProductImg').value.trim();
        
        // ValidaciÃ³n bÃ¡sica
        if (!name || isNaN(price) || price <= 0 || !img) {
            alert('Por favor, completa todos los campos correctamente (Nombre, Precio > 0, URL de Imagen).');
            return;
        }

        const newStock = {
            S: parseInt(document.getElementById('newStockS').value, 10) || 0,
            M: parseInt(document.getElementById('newStockM').value, 10) || 0,
            L: parseInt(document.getElementById('newStockL').value, 10) || 0,
            XL: parseInt(document.getElementById('newStockXL').value, 10) || 0,
            XXL: parseInt(document.getElementById('newStockXXL').value, 10) || 0,
        };

        const newProduct = {
            name: name,
            price: price,
            img: img,
            stock: newStock
        };

        // ğŸš© MEDIDA DE SEGURIDAD: Usamos el mÃ©todo .push() para aÃ±adir de forma controlada a la estructura de datos.
        products.push(newProduct);
        
        // Limpiar formulario y actualizar vistas
        document.getElementById('newProductName').value = '';
        document.getElementById('newProductPrice').value = '';
        document.getElementById('newProductImg').value = '';
        document.getElementById('newStockS').value = '0';
        document.getElementById('newStockM').value = '0';
        document.getElementById('newStockL').value = '0';
        document.getElementById('newStockXL').value = '0';
        document.getElementById('newStockXXL').value = '0';
        
        saveStockToLocalStorage(); // Guardar el nuevo producto inmediatamente
        alert('Producto agregado y guardado. Recuerda revisar y guardar los cambios adicionales.');
    }

    // Exportar stock a un formato legible (JSON)
    function exportStock() {
        const exportData = JSON.stringify(products, null, 2);
        prompt("Copia el siguiente stock (JSON) para guardar o compartir:", exportData);
    }

    // --- FUNCIONES DE VISTA DE USUARIO ---

    // Cambia el talle activo y actualiza la vista de productos
    function setTalle(talle) {
        currentTalle = talle;
        document.getElementById('talleTitle').innerHTML = `ğŸ‘• Modelos disponibles en talle: <strong>${talle}</strong>`;

        // Actualiza el estilo de los botones de talle
        document.querySelectorAll('.size-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.textContent === talle) {
                btn.classList.add('active');
            }
        });

        renderProducts();
    }

    // Renderiza la cuadrÃ­cula de productos para el talle actual
    function renderProducts() {
        const grid = document.getElementById('productGrid');
        grid.innerHTML = ''; // Limpiar la cuadrÃ­cula

        // Ordenar: primero los que tienen stock, luego los agotados.
        const sortedProducts = products.slice().sort((a, b) => {
            const stockA = a.stock[currentTalle] || 0;
            const stockB = b.stock[currentTalle] || 0;
            if (stockA > 0 && stockB === 0) return -1;
            if (stockA === 0 && stockB > 0) return 1;
            return 0; // Mantener el orden original si el stock es el mismo (o ambos agotados)
        });

        sortedProducts.forEach((product, index) => {
            const stockQty = product.stock[currentTalle] || 0;
            const isAgotado = stockQty === 0;
            const isLowStock = stockQty > 0 && stockQty <= 3; // LÃ³gica simple para stock bajo
            const inCart = cart[`${index}_${currentTalle}`] || 0;
            const availableStock = stockQty - inCart;

            // ğŸš© MEDIDA DE SEGURIDAD: Uso de `textContent` para el stock y `product.name` en la tarjeta
            let cardHTML = `
                <div class="card ${isAgotado ? 'agotado' : ''}" data-index="${index}" data-talle="${currentTalle}">
                    <img src="${product.img}" alt="${product.name}" class="card-img">
                    <div class="card-body">
                        <div>
                            <div class="card-title">${product.name}</div>
                            <div class="card-price">$${product.price.toLocaleString('es-AR')}</div>
                        </div>
                        <div>
                            <div class="stock-qty ${isLowStock ? 'low' : ''}">
                                Stock: <span id="display-stock-${index}-${currentTalle}">${availableStock}</span> ${availableStock > 0 ? (isLowStock ? '(Â¡Ãšltimas unidades!)' : '') : ''}
                            </div>
                            <button class="btn-add" onclick="addToCart(${index}, '${currentTalle}', ${product.price})" ${availableStock <= 0 ? 'disabled' : ''}>
                                ${inCart > 0 ? `+ AÃ±adir (Ya en carrito: ${inCart})` : 'AÃ±adir al Pedido'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            grid.innerHTML += cardHTML;
        });
    }

    // AÃ±ade un producto al carrito
    function addToCart(index, talle, price) {
        const key = `${index}_${talle}`;
        const product = products[index];
        const stockQty = product.stock[talle] || 0;
        const currentCartQty = cart[key] || 0;
        const availableStock = stockQty - currentCartQty;

        if (availableStock > 0) {
            // ğŸš© MEDIDA DE SEGURIDAD: Aumentar la cantidad del carrito solo si hay stock disponible.
            cart[key] = currentCartQty + 1;
            
            // Actualizar vista de stock disponible y botÃ³n
            document.getElementById(`display-stock-${index}-${talle}`).textContent = availableStock - 1;
            const button = document.querySelector(`.card[data-index="${index}"][data-talle="${talle}"] .btn-add`);
            if (button) {
                button.innerHTML = `+ AÃ±adir (Ya en carrito: ${cart[key]})`;
                if (availableStock - 1 <= 0) {
                    button.disabled = true;
                }
            }

            updateCartTotals();
            showToast();
        } else {
            alert('Â¡Sin stock disponible para este talle!');
        }
    }

    // Actualiza el total y el contador de prendas en la barra inferior
    function updateCartTotals() {
        let totalItems = 0;
        let totalPrice = 0;
        let whatsappMessage = 'Hola, mi pedido mayorista es:\n\n';

        for (const key in cart) {
            const [index, talle] = key.split('_');
            const qty = cart[key];
            const product = products[parseInt(index, 10)];
            
            if (qty > 0) {
                totalItems += qty;
                totalPrice += qty * product.price;
                whatsappMessage += `${qty} x ${product.name} (Talle: ${talle}) - $${(qty * product.price).toLocaleString('es-AR')}\n`;
            }
        }

        document.getElementById('totalPrice').textContent = `$${totalPrice.toLocaleString('es-AR')}`;

        const totalCountElement = document.getElementById('totalCount');
        totalCountElement.textContent = `${totalItems} prendas (${totalItems >= MIN_ITEMS ? 'Â¡MÃ­nimo Cubierto!' : `MÃ­n. ${MIN_ITEMS} - Faltan ${MIN_ITEMS - totalItems}`})`;
        
        const waButton = document.getElementById('waButton');
        waButton.classList.remove('ready');
        totalCountElement.classList.remove('ready-status');

        if (totalItems >= MIN_ITEMS) {
            waButton.classList.add('ready');
            totalCountElement.classList.add('ready-status');
            whatsappMessage += `\nTotal: $${totalPrice.toLocaleString('es-AR')}`;
            waButton.href = `https://wa.me/XXXXXXXXXX?text=${encodeURIComponent(whatsappMessage)}`; // **REEMPLAZA XXXXXXXXXX CON TU NÃšMERO DE WHATSAPP**
        } else {
            waButton.href = '#';
        }
    }

    // Muestra una notificaciÃ³n temporal de producto agregado
    function showToast() {
        const toast = document.getElementById('toast');
        toast.style.display = 'block';
        setTimeout(() => {
            toast.style.display = 'none';
        }, 800);
    }

    // --- FUNCIONES DE ACTIVACIÃ“N DE ADMIN ---

    function checkAdminKey(value) {
        if (value.toLowerCase() === 'admin') {
            document.getElementById('adminPanel').classList.add('show');
            document.getElementById('adminTrigger').value = ''; // Limpiar el campo
        }
    }

    function closeAdminPanel() {
        document.getElementById('adminPanel').classList.remove('show');
        renderProducts(); // AsegÃºrate de actualizar los productos visibles al salir del panel
    }

    // --- INICIALIZACIÃ“N ---

    document.addEventListener('DOMContentLoaded', () => {
        loadStock(); // Cargar el stock al inicio
        setTalle(currentTalle); // Iniciar la vista en el talle 'S' por defecto (o el que se defina)
        updateCartTotals();
    });

</script>

<style>
Â  Â  /* ESTILOS PARA EL TOAST (NotificaciÃ³n) */
Â  Â  .toast {
Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  bottom: 100px;
Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  Â  background-color: rgba(50, 50, 50, 0.9);
Â  Â  Â  Â  color: white;
Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  z-index: 5001;
Â  Â  Â  Â  display: none; /* Inicialmente oculto */
Â  Â  Â  Â  font-weight: bold;
Â  Â  }
</style>


</body></html>
