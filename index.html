<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cat√°logo Oficial - Fabricante</title>
    <style>
        /* --- ESTILOS GENERALES Y LAYOUT --- */
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; background-color: #f8f8f8; padding-bottom: 120px; color: #333; }
        header { background-color: #D60000; color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
        h1 { margin: 0; font-size: 1.4rem; text-transform: uppercase; letter-spacing: 1px; } 
        .subtitle { font-size: 0.8rem; color: rgba(255,255,255,0.8); margin-top: 4px; }
        .quality-description { padding: 20px 15px; background-color: white; border-bottom: 1px solid #eee; text-align: center; font-size: 0.9rem; color: #555; line-height: 1.5; }
        
        /* BARRA DE TALLES */
        .size-bar { display: flex; gap: 10px; padding: 15px; background: white; overflow-x: auto; white-space: nowrap; border-bottom: 1px solid #e0e0e0; scrollbar-width: none; }
        .size-bar::-webkit-scrollbar { display: none; }
        .size-btn { flex: 0 0 auto; padding: 10px 20px; border: 1px solid #333; background: white; color: #333; border-radius: 50px; font-weight: bold; font-size: 0.9rem; transition: 0.2s; cursor: pointer; }
        .size-btn.active { background: #D60000; color: white; border-color: #D60000; transform: scale(1.05); }

        /* GRILLA DE PRODUCTOS: 2 COLUMNAS */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 10px; 
            padding: 10px; 
            max-width: 800px; 
            margin: 0 auto; 
        }
        
        /* TARJETA DE PRODUCTO */
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; flex-direction: column; position: relative; }
        .card.agotado { opacity: 0.6; filter: grayscale(100%); order: 9999; }
        .card.agotado::after { content: "SIN STOCK"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-10deg); border: 2px solid #D60000; color: #D60000; font-weight: bold; padding: 5px 10px; border-radius: 5px; background: rgba(255,255,255,0.9); z-index: 10; font-size: 1rem; }
        .card-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; background: #eee; }
        .card-body { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        
        /* CAMBIO V8: T√çTULO COMPLETO, sin cortar */
        .card-title { 
            font-weight: 600; 
            font-size: 0.85rem; 
            margin-bottom: 4px; 
            line-height: 1.2; 
            /* Se eliminan las propiedades que cortaban el texto */
        } 
        
        .card-price { font-size: 1rem; font-weight: 800; color: #111; margin-top: auto; }
        .stock-qty { font-size: 0.75rem; color: #777; margin-top: 2px; }
        .stock-qty.low { color: #D60000; font-weight: bold; }
        .btn-add { width: 100%; padding: 10px; background: #333; color: white; border: none; font-weight: 600; border-radius: 8px; margin-top: 8px; font-size: 0.85rem; cursor: pointer; }
        .btn-add:disabled { background: #ccc; cursor: not-allowed; }

        /* BARRA INFERIOR FLOTANTE */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #eee; padding: 15px; box-shadow: 0 -4px 20px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; z-index: 2000; box-sizing: border-box; padding-bottom: max(15px, env(safe-area-inset-bottom)); }
        .nav-info { display: flex; flex-direction: column; }
        .nav-total { font-weight: 800; font-size: 1.1rem; color: #333; }
        .nav-count { font-size: 0.8rem; color: #D60000; font-weight: bold; }
        .nav-count.ready-status { color: #25D366; }
        .btn-whatsapp { background: #25D366; color: white; text-decoration: none; padding: 12px 20px; border-radius: 50px; font-weight: bold; font-size: 0.9rem; opacity: 0.5; pointer-events: none; transition: 0.3s; }
        .btn-whatsapp.ready { opacity: 1; pointer-events: auto; }

        /* PANEL DE ADMINISTRACI√ìN OCULTO */
        #adminPanel { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); color: white; z-index: 5000; padding: 10px; box-sizing: border-box; display: none; flex-direction: column; align-items: center; overflow-y: auto; }
        #adminPanel.show { display: flex; }
        #adminPanel h2 { color: #FFD700; margin-top: 0; }
        #adminPanel table { width: 100%; max-width: 800px; border-collapse: collapse; margin-top: 15px; background: white; color: #333; font-size: 0.8rem; }
        #adminPanel th, #adminPanel td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        #adminPanel th { background-color: #f2f2f2; color: #333; position: sticky; top: 0; }
        #adminPanel td:nth-child(1) { text-align: left; max-width: 150px; white-space: normal; overflow: visible; text-overflow: clip; } /* T√≠tulo completo en el admin tambi√©n */
        .stock-control { display: flex; align-items: center; justify-content: center; gap: 5px; }
        .stock-control button { width: 25px; height: 25px; border: none; background: #D60000; color: white; border-radius: 4px; font-weight: bold; cursor: pointer; padding: 0; line-height: 1; }
        .stock-control span { min-width: 20px; display: inline-block; text-align: center; font-weight: bold; }
        .admin-buttons { position: sticky; bottom: 0; background: rgba(0, 0, 0, 0.95); padding: 15px; width: 100%; max-width: 800px; text-align: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.5); }
        .admin-buttons button { background: #25D366; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin: 5px; }
        .admin-buttons a { color: #D60000; font-weight: bold; margin: 5px; cursor: pointer; text-decoration: none; display: block; margin-top: 10px; }
    </style>
</head>
<body>

<header>
    <h1>CATALOGO - FABRICANTE</h1>
    <div class="subtitle">Cat√°logo Mayorista - Stock Actualizado</div>
</header>

<div class="quality-description">
    En <strong>CAT√ÅLOGO - FABRICANTE</strong> nos enorgullece ofrecerte indumentaria de la m√°s alta calidad.
</div>

<div class="size-bar">
    <button class="size-btn" onclick="setTalle('S')">S</button>
    <button class="size-btn" onclick="setTalle('M')">M</button>
    <button class="size-btn" onclick="setTalle('L')">L</button>
    <button class="size-btn" onclick="setTalle('XL')">XL</button>
    <button class="size-btn" onclick="setTalle('XXL')">XXL</button>
</div>

<div style="text-align:center; padding: 15px 10px; font-weight:bold; color:#555; font-size: 0.9rem;" id="talleTitle">
    üëá Toca un talle para ver modelos
    <input type="text" id="adminTrigger" onkeyup="checkAdminKey(this.value)" placeholder="Escribe 'admin' para abrir el panel" style="width:90%; max-width: 300px; padding: 8px; margin-top: 10px; border-radius: 4px; border: 1px solid #ccc; font-size: 0.9rem;">
</div>

<div class="grid" id="productGrid"></div>

<div id="toast" class="toast">‚úÖ Agregado</div>

<div class="bottom-nav">
    <div class="nav-info">
        <span class="nav-total" id="totalPrice">$0</span>
        <span class="nav-count" id="totalCount">0 prendas (M√≠n. 6)</span>
    </div>
    <a href="#" id="waButton" class="btn-whatsapp" target="_blank">CONFIRMAR PEDIDO</a>
</div>

<div id="adminPanel">
    <h2>üõ†Ô∏è AJUSTE DE STOCK POR UNIDAD</h2>
    <div class="admin-note" style="color: #ccc;">
        Usa los botones [+] y [-] para modificar el stock. Cuando termines, haz clic en "Generar Nuevo Cat√°logo" para descargar el archivo final.
    </div>
    <table id="adminTable">
        <thead>
            <tr>
                <th>Modelo</th>
                <th>S</th>
                <th>M</th>
                <th>L</th>
                <th>XL</th>
                <th>XXL</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>
    <div class="admin-buttons">
        <button onclick="generarNuevoCat√°logo()">Generar Nuevo Cat√°logo y Descargar</button>
        <a onclick="document.getElementById('adminPanel').classList.remove('show'); document.getElementById('adminTrigger').value = '';">Cerrar Panel</a>
    </div>
</div>
<script>
    const MI_WHATSAPP = "5491135723388";
    const MINIMO_COMPRA = 6;
    const ORDEN_TALLES = ['S', 'M', 'L', 'XL', 'XXL'];

    // STOCK BASE PERMANENTE: Esta variable se reemplaza al generar el nuevo cat√°logo.
    let productosStringCSV = `
        Nike Air Blanco R:NEGRA,10000,https://i.postimg.cc/rFx221zQ/52c89571-3b94-4126-b534-c02da7681df6.jpg,3,0,0,0,0
        Hugo Cuadro Rojo/blanco R:Negra,10000,https://i.postimg.cc/jqGY1gqD/54ac34fb-f3ed-4754-9320-b49503abad73.jpg,5,2,0,1,0
        Nike Airmax Verde/Gris R:Negra,10000,https://i.postimg.cc/vHfwwrDt/aa3c03f0-6cd6-4482-9517-d89f55245725.jpg,1,4,0,0,0
        Nike Logo Blanco R:Roja,10000,https://i.postimg.cc/23pGxBDm/d70d62b1-3591-4b3c-aa69-3c3139ff0185.jpg,1,0,2,3,1
        Jordan Letras Negro/Rojo R:Blanca,10000,https://i.postimg.cc/mZ0WnXZ4/8f56ebb1-cea1-4bdb-8d48-6e48b850ec6b.jpg,2,0,0,0,0
        Varez Porsche Negro R:Blanca,10000,https://i.postimg.cc/YqYBB6j4/b44f3cab-4864-4469-8919-c31d45de2e71.jpg,1,0,2,0,0
        Boss Rayas Blancas R:Negra,10000,https://i.postimg.cc/wxtd08pm/39cf252d-0f84-4856-8a4c-f5c11051cc0d.jpg,4,1,0,0,0
        Nike Pipa Roja(Adelante) R:Blanca,10000,https://i.postimg.cc/QNRZz4NH/7f7d70fb-81e3-4240-b6f0-9f1870333f89.jpg,2,0,0,0,0
        Jordan Fligh Blanco R:Roja,10000,https://i.postimg.cc/Y2JBPnrT/37f5c918-9099-4ab5-8c10-7d5822555aad.jpg,1,2,2,3,2
        Nike Street Negro R:Blanca,10000,https://i.postimg.cc/L4rFWC4g/22976e5b-4848-4e7f-8b4d-53e6b32203d0.jpg,2,0,0,0,1
        Adidas Clasica Negro R:Francia,10000,https://i.postimg.cc/44rR0L43/509c2b17-7c8a-46ad-bf27-1ef32e5d4fe5.jpg,1,0,0,0,0
        Nike Pipa Negra (atras) R:Blanca,10000,https://i.postimg.cc/3JmQQXWx/41c7cf76-fe19-4ba5-bc31-d39812f1142d.jpg,1,0,0,0,0
        Nike Pipa Blanca (atras) R:Rosa,10000,https://i.postimg.cc/2jPNtcjf/3d833efd-fcb4-4e5f-a196-46a29ea777cd.jpg,1,0,0,0,0
        Nike Street Azul R:Negro,10000,https://i.postimg.cc/FF2X6WFH/92173d77-70b3-44d2-8969-d67255a07c4f.jpg,1,0,0,0,0
        Nike mini Street Rojo R:Blanca,10000,https://i.postimg.cc/J79CF67C/84d02739-dad6-44b0-a393-71592f770343.jpg,1,1,0,0,0
        Fox Modelo Nuevo Blanco R:Negra,10000,https://i.postimg.cc/v8VMzFrN/IMG-3643.jpg,1,0,2,1,0
        Jordan Letras Rojo/Blanco R:Negra,10000,https://i.postimg.cc/DyFb1gVF/IMG-5606.jpg,1,1,0,0,0
        Nike Pipa Blanca (Adelante) R:Negra,10000,https://i.postimg.cc/nV913TwS/IMG-3626.jpg,1,0,0,0,0
        New Era Yankee Blanco R:Negra,10000,https://i.postimg.cc/zf3hVXs6/d647b946-92d7-40ec-88d6-7013a6ce0ae9.jpg,1,1,1,1,1
        Jordan Nba Negro R:Blanca,10000,https://i.postimg.cc/PJ1YT3gj/IMG-4837.jpg,1,0,0,1,1
        Jordan Fligh Blanco R:Negra,10000,https://i.postimg.cc/Qt2cLGn7/IMG-4825.jpg,0,1,0,0,0
        Nike Street Blanco R:Negra,10000,https://i.postimg.cc/qvJyHGjf/305649ad-9602-4fa8-821f-ef27b1b7904d.jpg,0,1,0,0,0
        Nike Codigo Rojo/Blanco R:Negra,10000,https://i.postimg.cc/056qcRsT/72af3176-5257-444f-a288-8c6b9612d488.jpg,0,1,0,1,0
        Nike Pipa Blanca (Adelante) R:GrisTopo,10000,https://i.postimg.cc/FHwrVrf7/IMG-5711.jpg,0,1,0,0,0
        Boss Cuadro Blanco R:Negra,10000,https://i.postimg.cc/q79NqcXV/IMG-4635.jpg,0,1,0,0,0
        Jordan Bulls 23 Negro R:Roja,10000,https://i.postimg.cc/G3B1qwRn/611dc49b-aecf-4a2e-b970-43d06b9bc756.jpg,0,1,1,0,0
        Jordan Bulls 23 Blanco R:Roja,10000,https://i.postimg.cc/yWqjTSH6/693bcdc1-3f93-4ebd-8fb8-74429516b8e6.jpg,0,0,0,2,1
        Nike Street Blanco R:Francia,10000,https://i.postimg.cc/bwmby2Bk/f10f8752-41b4-4db7-93c2-78dda6cb5661.jpg,0,2,2,0,0
        Calvin Klein CK Gris/Negro R:Rosa,10000,https://i.postimg.cc/pd3zn5M1/IMG-6044.jpg,0,1,1,1,0
        Calvin Klein CK Gris/Blanco R:Negra,10000,https://i.postimg.cc/XvtdyB6P/IMG-6045.jpg,0,1,1,1,1
        Nike Pipa Negra (Adelante) R:Rosa,10000,https://i.postimg.cc/QMv1WKZy/IMG-6046.jpg,0,1,1,1,0
        Jordan Nba Blanco R:Negra,10000,https://i.postimg.cc/7YySm4zq/IMG-4971.jpg,1,1,1,0,0
        Nike Pipa bLanca (Adelante) R:Francias,10000,https://i.postimg.cc/kDrsytmB/a8adcd5e-0f96-4c1a-8dd4-8584cdf35d0f.jpg,0,0,1,0,0
        Jordan Flight Rojo/Negro R:Blanco,10000,https://i.postimg.cc/4dDpCkFV/IMG-4826.jpg,0,0,1,0,1
        Alpinestar Clasico R:Negra,10000,https://i.postimg.cc/tR6h3JYW/IMG-4925.jpg,0,0,1,0,0
        Fox Modelo Nuevo Negro R:Blanca,10000,https://i.postimg.cc/6p4w3kH5/IMG-5724.jpg,0,0,1,0,0
        Nike Letra Rosa R:Negra,10000,https://i.postimg.cc/4d9hQ2N4/a6424209-331a-4fb6-9a4e-320f58e2a9d8.jpg,0,0,1,0,0
        Porsche Dorado R:Negra,10000,https://i.postimg.cc/wjMMk4wR/IMG-5699.jpg,0,0,1,0,1
        Jordan Letras Blanco/Negro R:Roja,10000,https://i.postimg.cc/dQC823LZ/IMG-4924.jpg,0,0,1,0,0
        Ktm Racing Clasico naranja/negro R:Blanca,10000,https://i.postimg.cc/qMRpfSYY/IMG-5720.jpg,0,0,0,1,1
        Nike Street Negro R:Francia,10000,https://i.postimg.cc/DmVb89VS/IMG-6047.jpg,0,0,0,1,0
        Nike Street Blanco R:Rojo,10000,https://i.postimg.cc/KYVMLhbC/f1cb4def-44fc-4060-a426-28b647f8fa25.jpg,0,0,0,2,0
        Jordan 23 R:Negro,10000,https://i.postimg.cc/3r0Zt9bd/IMG-3541.jpg,0,0,0,1,0
        Nike Pipa Blanca (Atras) R:Francia,10000,https://i.postimg.cc/brRswsRG/IMG-6050.jpg,0,0,0,1,0
        Jordan Nube air R:Negra,10000,https://i.postimg.cc/kgqFXCMt/IMG-3712.jpg,0,0,0,1,0
        Nike Street Negro R:Francia,10000,https://i.postimg.cc/DmVb89VS/IMG-6047.jpg,0,0,0,1,0
        Nike Street Negro R:Roja,10000,https://i.postimg.cc/wxmHV85t/A5BC38D5-1FDE-4BB6-971F-B926621A2D92.jpg,0,0,0,2,0
        Jordan Silueta Gris R:Negra,10000,https://i.postimg.cc/FsjV4zvb/034f812a-b81-4502-9dac-52be7d767243.jpg,0,0,0,1,0
        Nike Vertical Blanco R:Negra,10000,https://i.postimg.cc/cJjnYGW9/c1a59ef8-e644-4771-b804-087fb080eec4.jpg,0,0,0,1,0
        Nike Pipa Negra (Adelante) R:Blanca,10000,https://i.postimg.cc/L41RTKkJ/IMG-4053.jpg,0,0,0,0,1
        New Era Yankee Negro R:Blanca,10000,https://i.postimg.cc/WzqSrwxx/ec9851df-11b9-47d1-be9d-bac9ebbfd8fa.jpg,0,0,0,0,1
        Supreme Clasico Rojo (Adelante) R:Blanco,10000,https://i.postimg.cc/5yQpvSDT/64c0d982-ba9a-4c87-8b86-8ebe55982f55.jpg,0,0,0,0,1
        Ferrari Gris/Amarillo R:Negro,10000,https://i.postimg.cc/zBCGfsGp/IMG-5703.jpg,0,0,0,0,1
        Nike Pipa Blanca R:Roja,10000,https://i.postimg.cc/DyqPT0hX/IMG-4057.jpg,0,0,0,0,1
        MODELO AGOTADO EJEMPLO,AGOTADO,https://via.placeholder.com/300x300?text=AGOTADO,0,0,0,0,0
    `;

    let productos = parsearCSV(productosStringCSV);
    let carrito = [];
    let talleSeleccionado = null;
    
    // --- L√ìGICA DE ADMINISTRACI√ìN ---

    function checkAdminKey(value) {
        if (value.toLowerCase().trim() === 'admin') {
            openAdminPanel();
            document.getElementById('adminTrigger').value = ''; // Limpia el campo
        }
    }

    function openAdminPanel() {
        document.getElementById('adminPanel').classList.add('show');
        renderizarAdminTabla();
    }
    
    function renderizarAdminTabla() {
        const tbody = document.getElementById('adminTable').querySelector('tbody');
        tbody.innerHTML = ""; // Limpiar tabla

        // Aseguramos que la tabla de admin tambi√©n est√© ordenada alfab√©ticamente
        const productosOrdenados = [...productos].sort((a, b) => a.nombre.localeCompare(b.nombre));

        productosOrdenados.forEach((prod, index) => {
            // Buscamos el √≠ndice original para poder modificar el array 'productos' principal
            const prodIndex = productos.findIndex(p => p.nombre === prod.nombre);
            
            const row = tbody.insertRow();
            row.insertCell().textContent = prod.nombre;

            ORDEN_TALLES.forEach(talle => {
                const cell = row.insertCell();
                cell.innerHTML = `
                    <div class="stock-control">
                        <button onclick="ajustarStock(${prodIndex}, '${talle}', -1)">-</button>
                        <span id="stock-${prodIndex}-${talle}">${prod.stock[talle]}</span>
                        <button onclick="ajustarStock(${prodIndex}, '${talle}', 1)">+</button>
                    </div>
                `;
            });
        });
    }
    
    function ajustarStock(prodIndex, talle, cambio) {
        const prod = productos[prodIndex];
        const stockActual = prod.stock[talle];

        if (cambio < 0 && stockActual <= 0) return; // No permitir stock negativo
        
        const nuevoStock = stockActual + cambio;
        prod.stock[talle] = nuevoStock;
        
        // Actualiza el span en la tabla de admin
        document.getElementById(`stock-${prodIndex}-${talle}`).textContent = nuevoStock;
    }

    function generarNuevoCat√°logo() {
        // 1. Convertir el objeto 'productos' a la cadena CSV actualizada
        let nuevoCSVString = "";
        productos.forEach(prod => {
            const stockValues = ORDEN_TALLES.map(talle => prod.stock[talle] || 0).join(',');
            
            // Reconstruir la l√≠nea CSV: Nombre, Precio, URL, Stock S, Stock M, ...
            nuevoCSVString += `${prod.nombre},${prod.precio},${prod.img},${stockValues}\n`;
        });

        const newCSV = nuevoCSVString.trim();

        // 2. Proceso de inyecci√≥n en el HTML
        const escapedCSV = newCSV.replace(/`/g, '\\`').replace(/\$/g, '\\$');
        let htmlContent = document.documentElement.outerHTML;
        const regex = /(let productosStringCSV = `)([^]*?)(`;)/s;

        if (!regex.test(htmlContent)) {
             alert("Error: El archivo HTML est√° da√±ado.");
             return;
        }

        const newHtmlContent = htmlContent.replace(regex, `$1${escapedCSV}$3`);

        // 3. Generar el archivo para descarga
        const blob = new Blob([newHtmlContent], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        
        a.href = url;
        a.download = 'catalogo_ACTUALIZADO.html';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        alert("‚úÖ ¬°Nuevo Cat√°logo Generado y Descargado! Env√≠a 'catalogo_ACTUALIZADO.html'.");
        document.getElementById('adminPanel').classList.remove('show');
        
        // Actualiza la vista previa localmente
        productos = parsearCSV(newCSV); // Recargar productos para reflejar el nuevo orden/estado
        carrito = [];
        actualizarBarra();
        if (talleSeleccionado) renderizarProductos();
    }
    
    // --- L√ìGICA DE CAT√ÅLOGO (CON ORDEN ALFAB√âTICO) ---

    function parsearCSV(csv) {
        const lineas = csv.trim().split('\n').filter(linea => linea.trim() !== '');
        const nuevosProductos = [];
        lineas.forEach(linea => {
            const partes = linea.split(',').map(p => p.trim());
            if (partes.length >= (3 + ORDEN_TALLES.length)) { 
                const stockData = {};
                ORDEN_TALLES.forEach((talle, index) => {
                    stockData[talle] = parseInt(partes[3 + index], 10) || 0; 
                });
                nuevosProductos.push({
                    nombre: partes[0],
                    precio: partes[1] === "AGOTADO" ? "AGOTADO" : parseInt(partes[1], 10) || 0,
                    img: partes[2],
                    stock: stockData
                });
            }
        });
        
        // CAMBIO V8: Ordenar inmediatamente despu√©s de parsear
        nuevosProductos.sort((a, b) => a.nombre.localeCompare(b.nombre));
        
        return nuevosProductos;
    }

    function formatPrice(price) {
        if (typeof price === 'string') return price;
        return '$' + price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    function setTalle(talle) {
        talleSeleccionado = talle;
        document.getElementById('talleTitle').innerText = "Stock Disponible en Talle " + talle;
        document.querySelectorAll('.size-btn').forEach(btn => {
            btn.classList.remove('active');
            if(btn.innerText === talle) btn.classList.add('active');
        });
        renderizarProductos();
    }

    function renderizarProductos() {
        const grid = document.getElementById('productGrid');
        grid.innerHTML = "";
        if (!talleSeleccionado) return;

        // Se trabaja sobre el array 'productos' que ya est√° ordenado alfab√©ticamente
        let disponibles = [...productos].filter(p => (p.stock[talleSeleccionado] || 0) > 0 || p.precio === "AGOTADO");

        // El ordenamiento principal ya est√° hecho, solo movemos los agotados al final
        disponibles.sort((a, b) => {
            const stockA = a.stock[talleSeleccionado] || 0;
            const stockB = b.stock[talleSeleccionado] || 0;
            const esAgotadoA = (typeof a.precio === 'string') || (stockA === 0);
            const esAgotadoB = (typeof b.precio === 'string') || (stockB === 0);
            
            if (esAgotadoA && !esAgotadoB) return 1; 
            if (!esAgotadoA && esAgotadoB) return -1; 
            
            // Si tienen el mismo estado (ambos agotados o ambos con stock), respetamos el orden alfab√©tico
            return a.nombre.localeCompare(b.nombre);
        });

        if (disponibles.length === 0) {
            grid.innerHTML = `<div style="grid-column: 1/-1; text-align:center; padding:40px; color:#888;">No hay stock en Talle ${talleSeleccionado}.</div>`;
            return;
        }

        disponibles.forEach(prod => {
            const precioFijoAgotado = (typeof prod.precio === 'string');
            const stockActual = prod.stock[talleSeleccionado] || 0;
            const esAgotado = precioFijoAgotado || (stockActual === 0); 
            const precioTexto = formatPrice(prod.precio);
            const claseAgotado = esAgotado ? 'agotado' : '';
            const botonEstado = esAgotado ? 'disabled' : '';
            const textoBoton = esAgotado ? 'SIN STOCK' : 'AGREGAR';
            
            const stockDisplay = stockActual > 0 
                ? `<div class="stock-qty ${stockActual <= 3 ? 'low' : ''}">Stock: ${stockActual} un.</div>`
                : `<div class="stock-qty low">Agotado en Talle ${talleSeleccionado}</div>`;

            const card = document.createElement('div');
            card.className = `card ${claseAgotado}`;
            card.innerHTML = `
                <img src="${prod.img}" class="card-img" loading="lazy" alt="Foto">
                <div class="card-body">
                    <div>
                        <div class="card-title">${prod.nombre}</div>
                        <div class="${precioFijoAgotado ? 'price-tag-agotado' : 'card-price'}">${precioTexto}</div>
                        ${stockDisplay}
                    </div>
                    <button class="btn-add" ${botonEstado} onclick="agregarAlCarrito('${prod.nombre}', ${precioFijoAgotado ? 0 : prod.precio})">
                        ${textoBoton}
                    </button>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function agregarAlCarrito(nombre, precio) {
        const productoIndex = productos.findIndex(p => p.nombre === nombre);
        if (productoIndex !== -1 && productos[productoIndex].stock[talleSeleccionado] > 0) {
            productos[productoIndex].stock[talleSeleccionado]--;
            carrito.push({ nombre, precio, talle: talleSeleccionado });
            actualizarBarra();
            renderizarProductos(); 
            document.getElementById('toast').classList.add('show');
            setTimeout(() => document.getElementById('toast').classList.remove('show'), 1000);
        }
    }

    function actualizarBarra() {
        const totalPrecio = carrito.reduce((acc, item) => acc + item.precio, 0);
        const totalItems = carrito.length;
        const faltan = Math.max(0, MINIMO_COMPRA - totalItems);
        document.getElementById('totalPrice').innerText = formatPrice(totalPrecio);
        
        const countElement = document.getElementById('totalCount');
        const waButton = document.getElementById('waButton');

        if (totalItems >= MINIMO_COMPRA) {
            countElement.innerText = `${totalItems} unidades. M√çNIMO CUMPLIDO.`;
            countElement.classList.add('ready-status');
            waButton.classList.add('ready');
            generarLinkWhatsapp(totalPrecio);
        } else {
            countElement.innerText = `${totalItems} unidades (Faltan ${faltan} para el m√≠nimo)`;
            countElement.classList.remove('ready-status');
            waButton.classList.remove('ready');
            waButton.href = "#";
        }
    }

    function generarLinkWhatsapp(total) {
        let texto = `*NUEVO PEDIDO MAYORISTA:*%0A%0A`;
        let itemsMap = {};
        carrito.forEach(item => {
            const key = `${item.nombre} (Talle ${item.talle})`;
            if(!itemsMap[key]) itemsMap[key] = 0;
            itemsMap[key]++;
        });

        for (const [key, count] of Object.entries(itemsMap)) {
            texto += `‚ñ™Ô∏è ${count}x ${key}%0A`;
        }

        texto += `%0Aüí∞ *TOTAL APROX: ${formatPrice(total)}*%0A`;
        texto += `%0A---%0AEspero confirmaci√≥n de stock y el detalle del pago y env√≠o.`;

        document.getElementById('waButton').href = `https://wa.me/${MI_WHATSAPP}?text=${texto}`;
    }
</script>
</body>
</html>
